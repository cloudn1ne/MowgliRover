<!--
- 
- Mowgli Behavior v1.0
-
- (c) Georg Swoboda <cn@warp.at> 2022
- https://github.com/cloudn1ne/MowgliRover
-
- *) Larger sub-behaviors are in their own files, including versioning.
-
-->
<root main_tree_to_execute = "MainTree" >
    <include ros_pkg="mowgli" path="config/bt/docking_v1.0.xml"/>
    <include ros_pkg="mowgli" path="config/bt/undocking_v1.0.xml"/>
    <include ros_pkg="mowgli" path="config/bt/mowing_v1.0.xml"/>
    
    <BehaviorTree ID="WaitForOdom">
      <Sequence>
        <Timeout msec="600000">  <!-- Wait for up to 10min to regain /odom (GPS fix)-->
            <WaitForOdom/>
        </Timeout>
        <SayString message="============ ODOM is okay again ===========" />
      </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="TurnOffBladeWhenDocked">
      <Sequence name="Turn OFF Blade Motor when docked">
        <IsCharging/>        
        <IsMowing/>        
        <BladeMotorControl enable="0"/>        
      </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="hlc_START">
      <SubTree ID="Mowing"/> <!-- mowing_v1X.X.xml -->
    </BehaviorTree>

    <BehaviorTree ID="hlc_HOME">
      <SubTree ID="Docking"/> <!-- docking_v1X.X.xml -->
    </BehaviorTree>

    <BehaviorTree ID="hlc_PAUSE">           
      <Sequence name="PAUSE">      
        <DriveForward distance="1.0" planner="FTCPlanner"/>
      </Sequence>    
    </BehaviorTree>

    <BehaviorTree ID="hlc_STOP">
      <Sequence name="STOP">
        <DriveBackward distance="1.0" planner="DockingFTCPlanner"/>
      </Sequence>
    </BehaviorTree>


    <BehaviorTree ID="IDLE">
      <Sequence name="IDLE">
        <SayString message="IDLE: does nothing atm" />  
      </Sequence>
    </BehaviorTree>

     <BehaviorTree ID="MainTree">
        <Sequence name="root_sequence">                     
            <GetHighLevelCommand cmd_out="{high_level_command}"/>
            <SayString message="{high_level_command}" />
            <Switch4 
                name="High Level Command Switch"
                variable="{high_level_command}"
                case_1="1"
                case_2="2"
                case_3="3"
                case_4="4" 
            >
              <SubTree ID="hlc_START"/>
              <SubTree ID="hlc_HOME"/>
              <SubTree ID="hlc_PAUSE"/>
              <SubTree ID="hlc_STOP"/>
              <SubTree ID="IDLE"/><!-- default branch -->
            </Switch4>                
            <SubTree ID="TurnOffBladeWhenDocked"/>            
        </Sequence>
     </BehaviorTree>
</root>