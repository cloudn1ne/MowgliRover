<!--
- 
- Mowgli Docking v1.0
-
- (c) Georg Swoboda <cn@warp.at> 2022
- https://github.com/cloudn1ne/MowgliRover
-
- *) If currently charging (in Docking Station)
- *) Attemps to reach Docking Approach Point -> performs Docking Approach -> and the final Docking maneuver 
- *) If it fails to perform the Docking maneuver it will DriveBackward and retry 
-
-->
<root>
    <BehaviorTree ID="Docking">
        <Sequence>
            <Inverter>
                <IsCharging/> 
            </Inverter> 
            <RetryUntilSuccessful num_attempts="3">        
                <Fallback name="DockingAttemptWithFallback">
                    <Sequence name="DockingAttempt">        
                        <DockingApproachPoint docking_approach_distance="0.75" planner="FTCPlanner"/>        
                        <DockingApproach docking_approach_distance="0.75" planner="FTCPlanner"/>                 
                        <Docking docking_distance="0.50" planner="DockingFTCPlanner"/>     
                        <!-- wait a little then check we are still charging in case we didnt get it perfectly the first time -->                        
                        <Delay delay_msec="3000">
                            <IsCharging/>
                        </Delay>
                    </Sequence>
                    <ForceFailure> <!--force next retry attempt, by failing Fallback -->
                        <DriveBackward distance="1.5" planner="DockingFTCPlanner"/>
                    </ForceFailure>
                </Fallback>         
            </RetryUntilSuccessful>
        </Sequence>
    </BehaviorTree>
 </root>